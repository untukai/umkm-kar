steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Set up JDK 17
    uses: actions/setup-java@v4
    with:
      java-version: '17'
      distribution: 'temurin'
      
  - name: Setup Gradle
    uses: gradle/actions/setup-gradle@v3

  - name: Grant execute permission for gradlew
    run: chmod +x gradlew

  - name: Build with Gradle
    # Perintah ini akan membuat APK debug di lokasi standar
    run: ./gradlew assembleDebug

  # --- Langkah Tambahan untuk Memastikan Path Benar ---
  # Cek apakah file APK ada di lokasi yang diharapkan dengan pencarian fleksibel.
  - name: Find generated APK
    id: find_apk
    run: |
      # Cari file .apk apapun di dalam folder output utama
      APK_PATH=$(find ${{ github.workspace }}/app/build/outputs/apk/ -name "*.apk" -print -quit)
      
      if [ -z "$APK_PATH" ]; then
        echo "::error::APK file not found! Check your build logs. No APK was generated."
        # Exit dengan error agar job gagal jika APK tidak ditemukan
        exit 1 
      fi
      
      echo "Ditemukan APK pada jalur: $APK_PATH"
      echo "APK_FILE_PATH=$APK_PATH" >> $GITHUB_OUTPUT
  # -----------------------------------------------------

  - name: Upload APK as artifact
    uses: actions/upload-artifact@v4
    with:
      name: KODIK-Android-APK
      # Menggunakan output dari step sebelumnya untuk memastikan path benar
      path: ${{ steps.find_apk.outputs.APK_FILE_PATH }}
      retention-days: 7
